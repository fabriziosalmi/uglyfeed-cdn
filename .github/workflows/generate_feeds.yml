name: Generate Daily RSS Feeds

on:
  # Schedule the workflow to run daily at 00:00 UTC
  schedule:
    - cron: '0 0 * * *'
  # Allow the workflow to be triggered manually
  workflow_dispatch:

jobs:
  generate-feeds:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Check out the repository
    - name: Check out the repository
      uses: actions/checkout@v3

    # Step 2: Set up Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'  # Use the Python version your scripts are compatible with

    # Step 3: Install dependencies
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install wikipedia pyyaml

    # Step 4: Execute each script in the 'generators' folder and save outputs to 'happened-today' folder
    - name: Run battles.py
      run: python generators/ww2_battles.py --path happened-today/ww2_battles.xml

    - name: Run inventions.py
      run: python generators/inventions.py --path happened-today/inventions.xml

    - name: Run presidents.py
      run: python generators/presidents.py --path happened-today/presidents.xml

    - name: Run saints.py
      run: python generators/saints.py --path happened-today/saints.xml

    - name: Run explorations.py
      run: python generators/explorations.py --path happened-today/explorations.xml

    - name: Run arts_and_books.py
      run: python generators/arts.py --path happened-today/arts_and_books.xml

    - name: Run artists_birthdays.py
      run: python generators/artists.py --path happened-today/artists.xml

    - name: Run soccer_matches.py
      run: python generators/soccer.py --path happened-today/soccer.xml

    - name: Run ancient_battles.py
      run: python generators/ancient_battles.py --path happened-today/ancient_battles.xml

    # Step 5: Commit and push the generated XML files to the repository
    - name: Commit and push changes
      run: |
        git config --local user.name "GitHub Actions"
        git config --local user.email "actions@github.com"
        git add happened-today/*.xml
        git commit -m "Update RSS feeds"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
